<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <title>TodoList</title>
</head>
<body>
    <div class="container">
        <!-- Searchfield and the add button -->
        <div class="searchFieldContainer">
            <input id="inputField" placeholder="Search or add item" class="searchField"></input>
            <button id ="tempBtn"class="addButton roundedBtn" onClick="addTagOrTodo()">ADD</button>
        </div>
        <!-- List the available tags -->
        <div id="listOfTags" class="tagList"> 
        </div>
        <!-- List of all todos in the database -->
        <div class="todoListContainer">
            <ul id="listOfTodos" class="todoUl">
                
            </ul>
        </div>
    </div>
</body>
<script type="text/javascript">
    AWS.config.update({
    region: "eu-north-1",
    endpoint: 'https://dynamodb.eu-north-1.amazonaws.com',
    accessKeyId: "X",
    secretAccessKey: "Y"
    });

    var docClient = new AWS.DynamoDB.DocumentClient();

    var scanParams = {
        TableName: "TodoItem",
    };

    docClient.scan(scanParams, onScan);

    function onScan(err, data) {
        if (err) {
            console.error("Unable to scan the table. Error JSON:", JSON.stringify(err, null, 2));
        } else {
            // get all todos
            console.log("Scan succeeded.");

            var tagList = document.getElementById("listOfTags");

            var todoUl = document.getElementById("listOfTodos");

            //Iterate over the data
            data.Items.forEach(function(todo) {

                //Create the Tag buttons
                todo.tags.forEach(function(tag){
                    //TODO - no doubles - new search parameters?
                    var buttonTagList = document.createElement("button");
                    buttonTagList.setAttribute("class", "buttonTagList roundedBtn");
                    buttonTagList.innerHTML = tag.tagText;
                    buttonTagList.setAttribute("style", "background-color:"+tag.color);

                    tagList.append(buttonTagList);
                });

                //Create the list of Todos
                var todoLi = document.createElement("li");
                todoLi.setAttribute("class", "todoLi");

                //Checkbox div
                var todoChkDiv = document.createElement("div");
                todoChkDiv.setAttribute("class", "todoChkDiv");
                var chkBox = document.createElement("input");
                chkBox.setAttribute("type", "checkbox");
                todoChkDiv.appendChild(chkBox);
                
                //Todo text div
                var todoTxtDiv = document.createElement("div");
                todoTxtDiv.setAttribute("class", "todoTxtDiv");
                var todoText = document.createTextNode(todo.todo);
                todoTxtDiv.appendChild(todoText);

                //Tag buttons
                var todoTagsDiv = document.createElement("div");
                todoTagsDiv.setAttribute("class", "todoTagsDiv")
                todo.tags.forEach(function(tag){
                    var todoBtnTag = document.createElement("button");
                    todoBtnTag.innerHTML = tag.tagText;
                    todoBtnTag.setAttribute("style", "background-color:"+tag.color);
                    todoBtnTag.setAttribute("class", "roundedBtn");
                    todoTagsDiv.appendChild(todoBtnTag);
                });

               todoLi.append(todoChkDiv);
               todoLi.append(todoTxtDiv);
               todoLi.append(todoTagsDiv);
               todoUl.append(todoLi);
            });

            // continue scanning if more than 1Mb
            if (typeof data.LastEvaluatedKey != "undefined") {
                console.log("Scanning for more...");
                //Todo paging search results?
                // params.ExclusiveStartKey = data.LastEvaluatedKey;
                // docClient.scan(params, onScan);
            }
        }
    }
    function addTodo(){

    }
    function randomColor(){ //not really unique..
        var randRed = Math.random() * (255);
        var randGreen = Math.random() * (255);
        var randBlue = Math.random() * (255);
        var resultColor = "rgb("+ randRed + "," + randGreen + "," + randBlue + ")";

        // document.getElementById("tempBtn").setAttribute("style", "background-color:" + resultColor);
    }
    function addTagOrTodo(){
        var inputText = document.getElementById("inputField").value;
        if(inputText[0] === "#"){
            //ok add it as a tag
        }
        else{
            //ok its a todo, do we need tags?
        }
        console.log(inputText[0])
        // if()



    }
    </script>
</html>

<script>


</script>

