<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <title>TodoList</title>
</head>
<body>
    <div>
        <input placeholder="Search or add item"><button>ADD</button></input>
    </div>
    <div>
        <ul id="listOfTags">
            
        </ul>
    </div>
    <div>
        <ul id="listOfTodos">

        </ul>
    </div>
</body>
<script type="text/javascript">
    AWS.config.update({
    region: "eu-north-1",
    endpoint: 'https://dynamodb.eu-north-1.amazonaws.com',
    accessKeyId: "X",
    secretAccessKey: "Y"
    });

    var docClient = new AWS.DynamoDB.DocumentClient();

    var scanParams = {
        TableName: "TodoItem",
    };


    docClient.scan(scanParams, onScan);

    function onScan(err, data) {
        if (err) {
            console.error("Unable to scan the table. Error JSON:", JSON.stringify(err, null, 2));
        } else {
            // get all todos
            console.log("Scan succeeded.");
            var tagUl = document.getElementById("listOfTags");
            var todoUl = document.getElementById("listOfTodos");
            //Iterate over the data
            data.Items.forEach(function(todo) {

                //Create the Tag buttons
                todo.tags.forEach(function(tag){
                    //TODO - no doubles - new search parameters?
                    var tagLi = document.createElement("li");
                    var tagBtn = document.createElement("button");
                    tagBtn.innerHTML = tag.tagText;
                    tagBtn.setAttribute("style", "background-color:"+tag.color)
                    tagLi.appendChild(tagBtn);
                    tagUl.append(tagLi);
                });

               //Create the list of Todos
               var todoLi = document.createElement("li");
               var chkBox = document.createElement("input");
               chkBox.setAttribute("type", "checkbox");

               var todoText = document.createTextNode(todo.todo);
               console.log(todo)

                todoLi.appendChild(chkBox);
                todoLi.appendChild(todoText);

                todo.tags.forEach(function(tag){
                    var todoBtnTag = document.createElement("button");
                    todoBtnTag.innerHTML = tag.tagText;
                    todoBtnTag.setAttribute("style", "background-color:"+tag.color)
                    todoLi.appendChild(todoBtnTag);
                });

               todoUl.append(todoLi)
            });

            // continue scanning if more than 1Mb
            if (typeof data.LastEvaluatedKey != "undefined") {
                console.log("Scanning for more...");
                //Todo paging search results?
                // params.ExclusiveStartKey = data.LastEvaluatedKey;
                // docClient.scan(params, onScan);
            }
        }
    }


    


    </script>
</html>

<script>


</script>

